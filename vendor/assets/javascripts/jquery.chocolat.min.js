!function(d){images=[];var s=0;d.fn.Chocolat=function(c){c=d.extend({container:d("body"),displayAsALink:!1,linkImages:!0,linksContainer:"Choco_links_container",overlayOpacity:.9,overlayColor:"#fff",fadeInOverlayduration:500,fadeInImageduration:500,fadeOutImageduration:500,vache:!0,separator1:" | ",separator2:"/",leftImg:"images/left.gif",rightImg:"images/right.gif",closeImg:"images/close.gif",loadingImg:"images/loading.gif",currentImage:0,setIndex:0,setTitle:"",lastImage:0},c),s++,c.setIndex=s,images[c.setIndex]=[],this.each(function(e){0==e&&c.linkImages&&""==c.setTitle&&(c.setTitle=t(d(this).attr("rel")," ")),d(this).each(function(){images[c.setIndex].displayAsALink=c.displayAsALink,images[c.setIndex][e]=[],images[c.setIndex][e].adress=t(d(this).attr("href")," "),images[c.setIndex][e].caption=t(d(this).attr("title")," "),c.displayAsALink||d(this).unbind("click").bind("click",{id:c.setIndex,nom:c.setTitle,i:e},o)})});for(var a=0;a<images[c.setIndex].length;a++)if(images[c.setIndex].displayAsALink)return 0==d("#"+c.linksContainer).size()&&this.filter(":first").before('<ul id="'+c.linksContainer+'"></ul>'),d("#"+c.linksContainer).append('<li><a href="#" id="Choco_numsetIndex_'+c.setIndex+'" class="Choco_link">'+c.setTitle+"</a></li>"),e=this.parent(),d(this).remove(),""==d.trim(e.html())&&e.remove(),d("#Choco_numsetIndex_"+c.setIndex).unbind("click").bind("click",{id:c.setIndex,nom:c.setTitle,i:c.currentImage},o);function o(e){return c.currentImage=e.data.i,c.setIndex=e.data.id,c.setTitle=e.data.nom,c.lastImage=images[c.setIndex].length-1,d("#Choco_overlay").remove(),d("#Choco_content").remove(),c.container.append('<div id="Choco_overlay"></div><div id="Choco_content"><div id="Choco_close"></div><div id="Choco_loading"></div><div id="Choco_container_photo"><img id="Choco_bigImage" src="" /></div><div id="Choco_container_description"><span id="Choco_container_title"></span><span id="Choco_container_via"></span></div><div id="Choco_left_arrow" class="Choco_arrows"></div><div id="Choco_right_arrow" class="Choco_arrows"></div></div>'),d("#Choco_left_arrow").css("background-image","url("+c.leftImg+")"),d("#Choco_right_arrow").css("background-image","url("+c.rightImg+")"),d("#Choco_close").css("background-image","url("+c.closeImg+")"),d("#Choco_loading").css("background-image","url("+c.loadingImg+")"),"body"!==c.container.get(0).nodeName.toLowerCase()&&(c.container.css({position:"relative",overflow:"hidden","line-height":"normal"}),d("#Choco_content").css("position","relative"),d("#Choco_overlay").css("position","absolute")),d(document).unbind("keydown").bind("keydown",function(e){switch(e.keyCode){case 37:n(-1);break;case 39:n(1);break;case 27:r()}}),c.vache&&d("#Choco_overlay").click(function(){return r(),!1}),d("#Choco_left_arrow").unbind().bind("click",function(){return n(-1),!1}),d("#Choco_right_arrow").unbind().bind("click",function(){return n(1),!1}),d("#Choco_close").unbind().bind("click",function(){return r(),!1}),d(window).resize(function(){i(c.currentImage,!0)}),i(c.currentImage,!1),d("#Choco_overlay").css({"background-color":c.overlayColor,opacity:c.overlayOpacity}).fadeIn(c.fadeInOverlayduration),d("#Choco_content").fadeIn(c.fadeInImageduration,function(){}),!1}function i(e,o){c.currentImage=e,d("#Choco_loading").fadeIn(c.fadeInImageduration);var i,n,t=new Image;t.onload=function(){d("#Choco_bigImage").attr("src",images[c.setIndex][c.currentImage].adress);var e=function(e,o){var i=o+28*o/100,n=d("#Choco_container_description").height()+d("#Choco_close").height(),t=e+n,a=o/e,r=e/o;"body"==c.container.get(0).nodeName.toLowerCase()?(windowHeight=d(window).height(),windowWidth=d(window).width()):(windowHeight=c.container.height(),windowWidth=c.container.width());notFitting=!0;for(;notFitting;){var i=o+28*o/100,t=e+n;i>windowWidth?(o=100*windowWidth/128,e=r*o):t>windowHeight?(e=windowHeight-n,o=a*e):notFitting=!1}return{largeur:o,hauteur:e}}(t.height,t.width);!function(e,o,i){i&&(d("#Choco_container_photo, #Choco_content, #Choco_bigImage").stop(!0,!1).css({overflow:"visible"}),d("#Choco_bigImage").animate({height:e+"px",width:o+"px"},c.fadeInImageduration));d("#Choco_container_photo").animate({height:e,width:o},c.fadeInImageduration),d("#Choco_content").animate({height:e,width:o,marginLeft:-o/2,marginTop:-e/2},c.fadeInImageduration,"swing",function(){d("#Choco_bigImage").fadeTo(c.fadeInImageduration,1).height(e).width(o),i||(!function(){if(c.linkImages)for(var e=["Choco_right_arrow","Choco_left_arrow"],o=0;o<e.length;o++)hide=!1,"Choco_right_arrow"==e[o]&&c.currentImage==c.lastImage?(hide=!0,d("#"+e[o]).fadeOut(300)):"Choco_left_arrow"==e[o]&&0==c.currentImage&&(hide=!0,d("#"+e[o]).fadeOut(300)),hide||d("#"+e[o]).fadeIn(c.fadeOutImageduration)}(),d("#Choco_container_description").css("visibility","visible"),d("#Choco_close").fadeIn(c.fadeInImageduration))}).css("overflow","visible")}(e.hauteur,e.largeur,o),d("#Choco_loading").stop().fadeOut(c.fadeOutImageduration)},t.src=images[c.setIndex][c.currentImage].adress,c.currentImage!==c.lastImage&&(a=new Image,z=c.currentImage+1,a.src=images[c.setIndex][z].adress),i=c.currentImage+1,n=c.lastImage+1,d("#Choco_container_title").html(images[c.setIndex][c.currentImage].caption),d("#Choco_container_via").html(c.setTitle+c.separator1+i+c.separator2+n)}function n(e){if(!c.linkImages||0==c.currentImage&&-1==e||c.currentImage==c.lastImage&&1==e)return!1;d("#Choco_container_description").css("visibility","hidden"),d("#Choco_bigImage").fadeTo(c.fadeOutImageduration,0,function(){i(c.currentImage+parseInt(e),!1)})}function t(e,o){return void 0===e?o:e}function r(){d("#Choco_overlay").fadeOut(900,function(){d("#Choco_overlay").remove()}),d("#Choco_content").fadeOut(500,function(){d("#Choco_content").remove()}),c.currentImage=0}}}(jQuery);
